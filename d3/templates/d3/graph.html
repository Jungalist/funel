{% load staticfiles %}
<!DOCTYPE html>
    <html lang = "en" >
    <head >
    <meta charset = "utf-8" >
    <title> D3 Test </title> <script type = "text/javascript" src = "http://d3js.org/d3.v3.js" > </script> 
    </head> 
    <style >

    .node {
        fill: #d62728;
        stroke: #c7c7c7;
        stroke-width: 2 px;
    }

    .link {
        stroke: #777;
        stroke-width: 2px;
    }

    .overlay {
        fill: none;
        pointer-events: all;
    }

    </style>
    
    <body>

        <script type= "text/javascript" >
         var width = screen.width,
             height = screen.height;

    var color = d3.scale.category20();

    function zoom() {
            svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }

    //Define force properties
    var force = d3.layout.force()
        .charge(-150)
        .linkDistance(3)
        .size([width, height]);

    //Add the svg
    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .call(d3.behavior.zoom().scaleExtent([1, 8]).on("zoom", zoom))
        .append("g");



    
    //Add a rectangle that will detect events like scrolling
    /*svg.append("rect")
    .attr("class", "overlay")
    .attr("width", width)
    .attr("height", height);*/


    var data = {{ json | safe }};


    console.log(data.nodes[0])
        //Load in the json file
    //d3.json("", function(error, graph) {
   // d3.json("{% static 'co-prediction.json' %}", function(error, graph) {    
       // if (error) throw error;

        //Force, nodes and links loaded in and force started
        force
            .nodes(data.nodes)
            .links(data.links)
            .start();

        //Links
        var link = svg.selectAll(".link")
            .data(data.links)
            .enter().append("line")
            .attr("class", "link")
            //Width of the connection, take from strength value
            .style("stroke-width", function(d) {
                return Math.sqrt(2);
            });

        //Nodes
        var node = svg.selectAll(".node")
            .data(data.nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", 5)
            .style("fill", function(d) {
                return color(d.group);
            })
            .call(force.drag);


        

        node.append("title")
            .text(function(d) {
                return d.name;
            });

        force.on("tick", function() {
            link.attr("x1", function(d) {
                    return d.source.x;
                })
                .attr("y1", function(d) {
                    return d.source.y;
                })
                .attr("x2", function(d) {
                    return d.target.x;
                })
                .attr("y2", function(d) {
                    return d.target.y;
                });

            node.attr("cx", function(d) {
                    return d.x;
                })
                .attr("cy", function(d) {
                    return d.y;
                });
        });


    //});



    </script>
    <h1>{{ s }}</h1>
    </body> </html>
